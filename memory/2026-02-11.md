# 2026-02-11 — Initial Build + Fetch Delay & Count

## Summary
Built the Twitter/X Bookmarks Backup CLI tool from scratch. A Python CLI that fetches bookmarks from Twitter's internal GraphQL API and exports them to a single `bookmarks.md` file.

## Key Decisions
- **Direct API calls** via `httpx` instead of `bird` CLI (avoids Node.js dependency)
- **Cookie-based auth** using `auth_token` + `ct0` from browser DevTools
- **Single markdown output** file grouped by date, newest first
- **State tracking** via `.state/processed_ids.json` for incremental fetches

## Files Created
- `src/twitter_bookmarks/` — 8 modules (cli, config, client, parser, models, markdown, state, logging_config)
- `tests/` — 5 test files with 42 passing tests
- `pyproject.toml` — deps: httpx, click, tomli-w
- `README.md`, `ARCHITECTURE.md`, `CLAUDE.md`, `PROMPT.md`

## Fetch Delay & Count Feature (Session 2)
Added configurable delay between API requests and `--count` flag:
- `config.py`: Added `fetch_delay: float = 2.0` to `AppConfig`, `[fetch]` TOML section
- `client.py`: Added `delay` and `max_count` params to `fetch_all_bookmarks()`
- `cli.py`: Added `--count`/`-n` and `--delay` CLI options to `fetch` command
- Config hierarchy: CLI flag > config file > default (2.0s)
- 4 new tests (delay mock, max_count stop, max_count truncate, CLI help flags)

## Query ID & 404 Handling (Session 3)
Added configurable query ID and 404 error handling for stale GraphQL IDs:
- `client.py`: 404 response now raises descriptive error with instructions to update query ID. `TwitterClient` accepts `query_id` param (per-instance URL instead of module constant).
- `config.py`: Added `query_id: str | None` to `AppConfig`, stored under `[api]` section in TOML.
- `cli.py`: Added `--query-id-only` flag to `setup` for quick query ID updates without re-entering auth tokens. Full `setup` now prompts for optional query ID.
- `cli.py` (`fetch`): Passes `config.query_id` to `TwitterClient`.
- 2 new tests: `test_stale_query_id_raises`, `test_custom_query_id`
- Updated `ARCHITECTURE.md` and `README.md` with query ID docs and 404 troubleshooting.

## Status
- All 44 tests passing
- CLI working (`setup`, `fetch`, `status` commands)
- Not yet tested with real Twitter credentials
